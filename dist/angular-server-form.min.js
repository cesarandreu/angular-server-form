!function(r,e){"use strict";e.module("angular-server-form",[]).provider("serverForm",[function(){var r=this;r.errorsKey="errors",r.errorCode=422,r.logging=!0,r.$get=["$http","$q","$log",function(n,o,t){function i(r,e){(r.$render||r.$setViewValue)&&r.$setValidity("server",!1),r.$setPristine(),r.$server=e}function s(r){var e={};for(var n in r)r.hasOwnProperty(n)&&"$"!==n[0]&&(e[n]=r[n].hasOwnProperty("$modelValue")?r[n].$modelValue:s(r[n]));return e}var a=this;return a.serialize=function(r){var e={};return r.$name?e[r.$name]=s(r):e=s(r),e},a.applyErrors=function(n,o){if(e.isString(o))i(n,o);else if(e.isArray(o))i(n,o.join(", "));else for(var s in o)o.hasOwnProperty(s)&&(n.hasOwnProperty(s)?a.applyErrors(n[s],o[s]):n.$name===s?a.applyErrors(n,o[s]):r.logging&&t.warn("No place to render property",s,"in form",n))},a.clearErrors=function u(r){(r.$render||r.$setViewValue)&&r.$setValidity("server",!0),r.$setPristine(),r.$server="";for(var e in r)r.hasOwnProperty(e)&&"$"!==e[0]&&u(r[e])},a.submit=function(e,o){return a.clearErrors(e),e.$submitting=!0,e.$saved=!1,n(o).success(function(){e.$saved=!0}).error(function(n,o){e.$saved=!1,o===r.errorCode&&(r.errorsKey?a.applyErrors(e,n[r.errorsKey]):a.applyErrors(e,n))}).finally(function(){e.$submitting=!1})},a}]}]).directive("serverForm",["serverForm",function(r){return{restrict:"A",scope:{url:"@",method:"@",onSuccess:"=",onError:"="},require:"form",link:function(e,n,o,t){function i(n){e.$apply(function(){if(!t.$submitting){var o={url:e.url,method:e.method?e.method:"POST",data:r.serialize(t)};r.submit(t,o).then(e.onSuccess,e.onError)}n.preventDefault()})}n.on("submit",i),e.$on("destroy",function(){n.off("submit",i)})}}}])}(window,window.angular);